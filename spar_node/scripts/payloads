import rospy
from std_msgs.msg import UInt8
from gpiozero import Servo



SERVO_PIN_1 = 13#Green
epi_servo = Servo(SERVO_PIN_1)

SERVO_PIN_2 = 12#Yellow
tracker_servo = Servo(SERVO_PIN_2)



def callback(msg):
    # payload commands message structure:
    # both close:   0b00000000 (0)
    # both open:    0b00000011 (3)
    # tracker open: 0b00000010 (2)
    # epi open:     0b00000001 (1)
    
    if msg.data == 0:
        epi_servo.max()
        tracker_servo.max()
        rospy.loginfo("AHHHHHHHHHHHHHHHH")
        rospy.sleep(rospy.Duration(3))
    elif msg.data == 3 or msg.data == 1:
        epi_servo.min()
        rospy.sleep(rospy.Duration(3))
        rospy.loginfo("Epi-pen was deployed")
        epi_servo.max()
        if msg.data == 3:
            tracker_servo.min()
            rospy.sleep(rospy.Duration(3))
            rospy.loginfo("PLB Tracker was deployed")
            tracker_servo.max()
    elif msg.data == 2:
        tracker_servo.min()
        rospy.sleep(rospy.Duration(3))
        rospy.loginfo("PLB Tracker was deployed")
        tracker_servo.max()

def main():

    # Initialize ROS node
    rospy.init_node('servo_controller_node')
    
    # Subscribe to payloadcommands topic
    rospy.Subscriber('payloadcommands', UInt8, callback)
    
    # Keep the node alive
    rospy.spin()

if __name__ == '__main__':
    main()
